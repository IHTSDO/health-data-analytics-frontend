<nav class="navbar p-2">
    <a class="logo">
        <img class="logo mr-2 p-0" src="/assets/small_logo.png">
        <span class="title text-alto-white pl-3">Outcome Comparison - COVID 19 <i class="material-icons small">edit</i></span>
    </a>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="input-block col m-5 rounded-lg bg-river-bed">
            <div class="row py-3">
                <h2 class="col mb-0">Patient Criteria</h2>
                <i class="material-icons medium text-right mr-4">save</i>
            </div>

            <div class="colour-cell mb-4">
                <h3 class="col p-3 mb-0 bg-cadet rounded-top">Gender</h3>
                <span class="col count text-right">{{comparison?.cohort ? (comparison.cohort | number:'1.0-0') : '0'}} patients</span>
                <div class="input-group radios bg-cadet-lighter rounded-bottom p-3">
                    <input type="radio" id="gender-all" name="gender" class="p-2"
                           [checked]="comparison.gender === null"
                           (change)="changeGender(null)">
                    <label class="pl-2 pr-4 mb-0" for="gender-all">All</label>
                    <input type="radio" id="gender-male" name="gender" class="p-2"
                           [checked]="comparison.gender === 'MALE'"
                           (change)="changeGender('MALE')">
                    <label class="pl-2 pr-4 mb-0" for="gender-male">Male</label>
                    <input type="radio" id="gender-female" name="gender" class="p-2"
                           [checked]="comparison.gender === 'FEMALE'"
                           (change)="changeGender('FEMALE')">
                    <label class="pl-2 pr-4 mb-0" for="gender-female">Female</label>
                </div>
            </div>

            <div class="colour-cell mb-4">
                <h3 class="col p-3 mb-0 bg-cadet rounded-top">Condition</h3>
                <span class="col count text-right">{{comparison?.conditionCohort ? (comparison.conditionCohort | number:'1.0-0') : '0'}} patients</span>
                <ng-container *ngIf="exists('finding')">
                    <h3 class="col px-3 mb-0 bg-cadet-lighter">Finding</h3>
                    <div class="input-group bg-cadet-lighter px-3">
                        <ng-container *ngFor="let condition of comparison.condition; let i = index">
                            <input *ngIf="condition.type === 'finding'" class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                                   placeholder="Search for Concept..."
                                   [(ngModel)]="condition.ecl"
                                   (change)="changeCondition()"
                                   [ngbTypeahead]="search">
                            <i class="material-icons medium text-remove text-center col-1" (click)="comparison.condition.splice(i, 1)">remove</i>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngIf="exists('disorder')">
                    <h3 class="col px-3 mb-0 bg-cadet-lighter">Disorder</h3>
                    <div class="input-group bg-cadet-lighter px-3">
                        <ng-container *ngFor="let condition of comparison.condition; let i = index">
                            <input *ngIf="condition.type === 'disorder'" class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                                   placeholder="Search for Concept..."
                                   [(ngModel)]="condition.ecl"
                                   (change)="changeCondition()"
                                   [ngbTypeahead]="search">
                            <i class="material-icons medium text-remove text-center col-1" (click)="comparison.condition.splice(i, 1)">remove</i>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngIf="exists('medication')">
                    <h3 class="col px-3 mb-0 bg-cadet-lighter">Medication</h3>
                    <div class="input-group bg-cadet-lighter px-3">
                        <ng-container *ngFor="let condition of comparison.condition; let i = index">
                            <input *ngIf="condition.type === 'medication'" class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                                   placeholder="Search for Concept..."
                                   [(ngModel)]="condition.ecl"
                                   (change)="changeCondition()"
                                   [ngbTypeahead]="search">
                            <i class="material-icons medium text-remove text-center col-1" (click)="comparison.condition.splice(i, 1)">remove</i>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngIf="exists('procedure')">
                    <h3 class="col px-3 mb-0 bg-cadet-lighter">Procedure</h3>
                    <div class="input-group bg-cadet-lighter px-3">
                        <ng-container *ngFor="let condition of comparison.condition; let i = index">
                            <input *ngIf="condition.type === 'procedure'" class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                                   placeholder="Search for Concept..."
                                   [(ngModel)]="condition.ecl"
                                   (change)="changeCondition()"
                                   [ngbTypeahead]="search">
                            <i class="material-icons medium text-remove text-center col-1" (click)="comparison.condition.splice(i, 1)">remove</i>
                        </ng-container>
                    </div>
                </ng-container>
                <div class="bg-cadet-lighter rounded-bottom text-right p-3">
                    <button class="button add bg-fruit-salad rounded-pill px-3" mat-button [matMenuTriggerFor]="menu">ADD</button>
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="addCondition('finding')">
                            <span>Finding</span>
                        </button>
                        <button mat-menu-item (click)="addCondition('disorder')">
                            <span>Disorder</span>
                        </button>
                        <button mat-menu-item (click)="addCondition('medication')">
                            <span>Medication</span>
                        </button>
                        <button mat-menu-item (click)="addCondition('procedure')">
                            <span>Procedure</span>
                        </button>
                    </mat-menu>
                </div>
            </div>

            <div class="colour-cell mb-4">
                <h3 class="col p-3 mb-0 bg-cadet rounded-top">Compare Outcome</h3>
                <div class="input-group bg-cadet-lighter px-3 pt-3">
                    <ng-container *ngFor="let comparator of comparison.comparators; let i = index">
                        <input [ngStyle]="{'background-color': comparator.color}"
                               class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                               placeholder="Search for Concept..."
                               [(ngModel)]="comparator.ecl"
                               (change)="changeComparator(comparator)"
                               [ngbTypeahead]="search">
                        <i class="material-icons medium text-remove text-center col-1" (click)="removeComparator(i)">remove</i>
                    </ng-container>
                </div>
                <div class="bg-cadet-lighter rounded-bottom text-right px-3 pb-3">
                    <button class="button add bg-fruit-salad rounded-pill px-3"
                            (click)="addComparator()">ADD</button>
                </div>
            </div>

            <div class="colour-cell mb-4">
                <h3 class="col p-3 mb-0 lighter bg-haze rounded-top">No Refinements</h3>
                <span class="col count text-right">{{comparison.comorbidityCohort ? (comparison.comorbidityCohort | number:'1.0-0') : '0'}} patients</span>
                <h3 class="col p-3 mb-0 bg-haze-lighter rounded-bottom">Control Group</h3>
            </div>

            <ng-container *ngFor="let comorbidity of comparison.comorbidities">
                <div class="colour-cell mb-4">
                    <h3 class="col p-3 mb-0 lighter bg-haze rounded-top">Comorbidity: {{comorbidity.name ? comorbidity.name : '-'}}</h3>
                    <span class="col count text-right">{{comorbidity?.patientCount ? (comorbidity.patientCount | number:'1.0-0') : '0'}} patients</span>
                    <h3 class="col p-3 mb-0 bg-haze-lighter">Finding</h3>
                    <div class="input-group bg-haze-lighter px-3">
                        <ng-container *ngFor="let refinement of comorbidity.refinements; let i = index">
                            <input class="rounded-pill p-1 px-3 mb-3 w-100 col-11"
                                   placeholder="Search for Concept..."
                                   [(ngModel)]="refinement.ecl"
                                   (change)="changeComorbidity(comorbidity)"
                                   [ngbTypeahead]="search">
                            <i class="material-icons medium text-remove text-center col-1" (click)="comorbidity.refinements.splice(i, 1)">remove</i>
                        </ng-container>
                    </div>
                    <div class="bg-haze-lighter rounded-bottom text-right px-3 pb-3">
                        <button class="button add bg-fruit-salad rounded-pill px-3"
                                (click)="addComorbidityReference(comorbidity)">ADD</button>
                    </div>
                </div>
            </ng-container>

            <div class="mb-4 text-right">
                <button class="button add bg-fruit-salad rounded-pill px-3"
                        mat-button [matMenuTriggerFor]="refMenu">ADD REFINEMENT</button>
                <mat-menu #refMenu="matMenu">
                        <button mat-menu-item (click)="addComorbidity()">
                            <span>Comorbidity</span>
                        </button>
                        <button mat-menu-item>
                            <span>Product</span>
                        </button>
                        <button mat-menu-item>
                            <span>Procedure</span>
                        </button>
                    </mat-menu>
            </div>
            

            <div class="mb-6 text-center">
                <button class="button show-insight bg-fruit-salad rounded-lg p-3 ml-5 mb-5" (click)="showInsight()">SHOW INSIGHT</button>
            </div>
        </div>

        <div class="graph-block col-7 m-5">
            <!--<div class="p-3 m-3 rounded-lg">{{comparison | json}}</div>-->
<!--            <p>840539006 / 882784691000119100 + 419099009 / 414916001 + 73211009 + 38341003</p>-->
            <div class="text-right m-3 p-3" *ngIf="graphData.length && !percentage">
                <button class="button add bg-fruit-salad rounded-pill px-3"
                        (click)="togglePercentage()" style="color: #E0E0E0;">PERCENTAGE</button>
            </div>
            <div class="text-right m-3 p-3" *ngIf="graphData.length && percentage">
                <button class="button add bg-fruit-salad rounded-pill px-3"
                        (click)="togglePercentage()" style="color: #E0E0E0;">NUMERIC</button>
            </div>
                <ngx-charts-bar-vertical-2d *ngIf="graphData.length"
                    [scheme]="colorScheme"
                    [results]="graphData"
                    [gradient]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [legend]="false"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [yAxisLabel]="'Patients'"
                    [legendTitle]="'Key'"
                    (select)="onSelect($event)"
                    (activate)="onActivate($event)"
                    (deactivate)="onDeactivate($event)">
                </ngx-charts-bar-vertical-2d>
            <div class="text-right m-3 p-3" *ngIf="graphData.length">
                <button class="button add bg-fruit-salad rounded-pill px-3" 
                        style="color: #E0E0E0;" (click)="downloadFile()">DOWNLOAD</button>
            </div>
        </div>
        
    </div>
</div>
<footer class="footer">
    <a class="px-3 float-right text-ghost-grey" href="http://www.snomed.org/" target="_blank">Copyright © {{year}} SNOMED International</a>
</footer>

